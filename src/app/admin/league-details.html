<div class="container" style="padding-top: var(--space-lg);">
    <!-- Header -->
    <div class="flex-center" style="justify-content: space-between; margin-bottom: var(--space-lg);">
        <div>
            <h2 class="text-gradient">
                {{ leagueDetails()?.league_name || 'League Details' }}
            </h2>
            @if (leagueDetails(); as league) {
            <span class="badge"
                [style.background]="league.league_status === 'active' ? 'HSL(var(--color-success))' : 'HSL(var(--color-warning))'">
                {{ league.league_status }}
            </span>
            }
        </div>
        <div class="flex-center gap-md">
            @if (leagueDetails()) {
            <!-- <a [routerLink]="isRound1Slotted() ? null : ['/league/slotting']"
                [queryParams]="isRound1Slotted() ? null : {league_id: leagueId()}" class="btn btn-primary"
                [class.disabled]="isRound1Slotted()" [title]="isRound1Slotted() ? 'Round 1 is already slotted' : ''"
                style="background: HSL(var(--color-success));">
                {{ isRound1Slotted() ? 'Round 1 Slotted' : 'Slot Round 1 Games' }}
            </a> -->

            <a [routerLink]="['/league/slotting']" [queryParams]="{league_id: leagueId()}" class="btn btn-primary"
                style="background: HSL(var(--color-success));">
                Slot Round 1 Games
            </a>
            }
            <a routerLink="/admin" class="btn btn-secondary">Back to Admin</a>
        </div>
    </div>

    <!-- Loading State -->
    @if (loading()) {
    <div class="card text-center">
        <p style="color: var(--color-text-muted);">Loading league details...</p>
    </div>
    }

    <!-- Error State -->
    @if (error(); as errorMsg) {
    <div class="card" style="border-left: 4px solid var(--color-error);">
        <p style="color: var(--color-error);">{{ errorMsg }}</p>
    </div>
    }

    <!-- League Details Content -->
    @if (leagueDetails(); as league) {
    <div style="display: grid; gap: var(--space-lg);">

        <!-- League Information Card -->
        <div class="card" style="padding: var(--space-sm) var(--space-md);">
            <div class="flex-center" style="justify-content: flex-start; gap: var(--space-lg); flex-wrap: wrap;">
                <h3 style="margin: 0; font-size: 1.1rem; color: var(--color-accent);">League Information</h3>

                <div class="flex-center" style="gap: var(--space-md); flex-wrap: wrap;">
                    @if (league.league_start_date) {
                    <div class="info-item" style="flex-direction: row; align-items: baseline; gap: 8px;">
                        <label style="margin: 0;">Start:</label>
                        <span>{{ league.league_start_date | date:'mediumDate' }}</span>
                    </div>
                    }

                    @if (league.league_end_date) {
                    <div class="info-item" style="flex-direction: row; align-items: baseline; gap: 8px;">
                        <label style="margin: 0;">End:</label>
                        <span>{{ league.league_end_date | date:'mediumDate' }}</span>
                    </div>
                    }

                    @if (league.league_duration) {
                    <div class="info-item" style="flex-direction: row; align-items: baseline; gap: 8px;">
                        <label style="margin: 0;">Duration:</label>
                        <span>{{ league.league_duration }} weeks</span>
                    </div>
                    }
                </div>
            </div>
        </div>

        <!-- Players Table -->
        <div class="card">
            <div class="flex-center" style="justify-content: space-between; margin-bottom: var(--space-md);">
                <h3 style="margin: 0;">Registered Players</h3>
                <span class="badge" style="background: HSL(var(--color-accent)); color: black;">
                    {{ sortedPlayers().length }} players
                </span>
            </div>

            @if (sortedPlayers().length > 0) {
            <div class="table-container">
                <table class="players-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th class="sortable" (click)="sortBy('firstName')">
                                First Name {{ getSortIcon('firstName') }}
                            </th>
                            <th class="sortable" (click)="sortBy('lastName')">
                                Last Name {{ getSortIcon('lastName') }}
                            </th>
                            <th>Email</th>
                            <th class="sortable" (click)="sortBy('dupr_rating')">
                                DUPR Rating {{ getSortIcon('dupr_rating') }}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (player of sortedPlayers(); track player.email; let i = $index) {
                        <tr>
                            <td>{{ i + 1 }}</td>
                            <td>{{ player.firstName }}</td>
                            <td>{{ player.lastName }}</td>
                            <td>{{ player.email }}</td>
                            <td>
                                <span class="rating-badge">{{ player.dupr_rating || 'N/A' }}</span>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
            } @else {
            <p style="color: var(--color-text-muted); text-align: center; padding: var(--space-lg);">
                No players registered yet
            </p>
            }
        </div>


    </div>
    }
</div>