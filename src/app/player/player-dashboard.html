<div class="dashboard-container">
    <!-- Sidebar with League Selection and Navigation -->
    <aside class="sidebar">
        <h2 class="sidebar-title">Player Menu</h2>

        <div class="sidebar-group">
            <label class="sidebar-label">Select League</label>
            <div class="select-wrapper">
                <select [value]="selectedLeague()?.id" (change)="selectLeague($any($event.target).value)"
                    class="league-select">
                    <option value="" disabled>Choose a league...</option>
                    @for (league of leagues(); track league.id) {
                    <option [value]="league.id">{{ league.name }}</option>
                    }
                </select>
            </div>
        </div>

        <nav class="sidebar-nav">
            <button class="nav-item" [class.active]="activeSection() === 'matches'"
                (click)="setActiveSection('matches')">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                    </svg>
                </span>
                <span class="nav-label">Matches</span>
            </button>
            <button class="nav-item" [class.active]="activeSection() === 'leagues'"
                (click)="setActiveSection('leagues')">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path
                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z">
                        </path>
                    </svg>
                </span>
                <span class="nav-label">Leagues</span>
            </button>
            <button class="nav-item" [class.active]="activeSection() === 'stats'" (click)="setActiveSection('stats')">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21.21 15.89A10 10 0 118 2.83"></path>
                        <path d="M22 12A10 10 0 0012 2v10z"></path>
                    </svg>
                </span>
                <span class="nav-label">Stats</span>
            </button>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        @if (activeSection() === 'matches') {
        <header class="dashboard-header">
            <div>
                <h1 class="text-gradient">Upcoming Matches</h1>
                @if (selectedLeague()) {
                <p class="league-subtitle">{{ selectedLeague()?.name }}</p>
                }
            </div>
            <div class="header-actions">
                <a routerLink="/league" class="btn btn-secondary">Dashboard</a>
                <a routerLink="/player/leagues" class="btn btn-primary">Join League</a>
            </div>
        </header>

        <!-- Matches Grid -->
        <div class="matches-grid">
            @if (upcomingMatches().length === 0) {
            <div class="empty-state card">
                <h3>No upcoming matches</h3>
                <p style="color: var(--color-text-muted);">
                    Check back later or select a different league.
                </p>
            </div>
            }
            @for (match of upcomingMatches(); track match.id) {
            <div class="match-card card" (click)="viewMatchDetail(match.id)">
                <div class="match-header">
                    <div class="match-date">
                        <span class="date-text">{{ formatDate(match.date) }}</span>
                        <span class="time-text">{{ match.time }}</span>
                    </div>
                    <div class="match-meta">
                        @if (match.groupId) {
                        <span class="group-badge">Group {{ match.groupId.replace('G', '') || '?' }}</span>
                        }
                        <span class="court-badge">{{ match.court || 'Court TBD' }}</span>
                    </div>
                </div>

                <div class="match-teams">
                    <div class="team my-team">
                        <span class="team-label">My Team</span>
                        <span class="team-players">{{ getTeammates(match) || 'Partner TBD' }}</span>
                    </div>

                    <div class="vs-divider">VS</div>

                    <div class="team opponent-team">
                        <span class="team-label">Opponents</span>
                        <span class="team-players">{{ getOpponents(match) }}</span>
                    </div>
                </div>

                <div class="match-footer">
                    <span class="league-tag">{{ match.leagueName }}</span>
                    <span class="view-details">View Details →</span>
                </div>
            </div>
            }
        </div>

        <!-- Completed Matches Grid -->
        <header class="dashboard-header" style="margin-top: var(--space-xl); margin-bottom: var(--space-lg);">
            <div>
                <h1 class="text-gradient">Completed Matches</h1>
            </div>
        </header>

        <div class="matches-grid">
            @if (completedMatches().length === 0) {
            <div class="empty-state card">
                <h3>No completed matches</h3>
                <p style="color: var(--color-text-muted);">
                    As you finish matches, they will appear here.
                </p>
            </div>
            }
            @for (match of completedMatches(); track match.id) {
            <div class="match-card card completed-card" (click)="viewMatchDetail(match.id)">
                <div class="match-header">
                    <div class="match-date">
                        <span class="date-text">{{ formatDate(match.date) }}</span>
                        <span class="time-text">{{ match.time }}</span>
                    </div>
                    <div class="match-meta">
                        @if (match.groupId) {
                        <span class="group-badge">Group {{ match.groupId.replace('G', '') || '?' }}</span>
                        }
                        <span class="court-badge">{{ match.court || 'Court TBD' }}</span>
                    </div>
                </div>

                <div class="match-teams">
                    <div class="team my-team" [class.winner]="(match.team1Score || 0) > (match.team2Score || 0)">
                        <div class="team-info-row">
                            <span class="team-label">My Team</span>
                            <span class="final-score">{{ match.team1Score }}</span>
                        </div>
                        <span class="team-players">{{ getTeammates(match) || 'Partner TBD' }}</span>
                    </div>

                    <div class="vs-divider">VS</div>

                    <div class="team opponent-team" [class.winner]="(match.team2Score || 0) > (match.team1Score || 0)">
                        <div class="team-info-row">
                            <span class="team-label">Opponents</span>
                            <span class="final-score">{{ match.team2Score }}</span>
                        </div>
                        <span class="team-players">{{ getOpponents(match) }}</span>
                    </div>
                </div>

                <div class="match-footer">
                    <span class="league-tag">{{ match.leagueName }}</span>
                    <span class="view-details">Match Results →</span>
                </div>
            </div>
            }
        </div>

        <!-- Group Standings After All Completed Matches -->
        @if (completedMatches().length > 0 && completedMatches()[0].groupId) {
        <div class="group-standings-section" style="margin-top: var(--space-xl);">
            <h3 class="section-title">My Group Standings</h3>
            <div class="group-standings-mini card">
                <h4 class="standings-mini-title">
                    Group {{ completedMatches()[0].groupId!.replace('G', '') }} - Current Standings
                </h4>
                <table class="standings-mini-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Player</th>
                            <th class="text-center">Matches</th>
                            <th class="text-right">Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (standing of getGroupStandings(completedMatches()[0].groupId!); track standing.email; let i
                        = $index) {
                        <tr
                            [class.current-player]="standing.email === playerService.getCurrentPlayerId().toLowerCase()">
                            <td class="pos-mini">{{ i + 1 }}</td>
                            <td class="player-mini">
                                {{ standing.name }}
                                @if (standing.email === playerService.getCurrentPlayerId().toLowerCase()) {
                                <span class="you-indicator">YOU</span>
                                }
                            </td>
                            <td class="text-center">{{ standing.matchesPlayed }}</td>
                            <td class="score-mini text-right">{{ standing.totalScore }}</td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        }
        }

        @if (activeSection() === 'leagues') {
        <header class="dashboard-header">
            <div>
                <h1 class="text-gradient">My Leagues</h1>
                <p class="league-subtitle">Leagues you are currently participating in</p>
            </div>
            <div class="header-actions">
                <a routerLink="/player/leagues" class="btn btn-primary">Find More Leagues</a>
            </div>
        </header>

        <div class="leagues-grid"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: var(--space-lg);">
            @for (league of leagues(); track league.id) {
            <div class="match-card card" [class.selected]="selectedLeague()?.id === league.id"
                (click)="selectLeague(league.id); setActiveSection('matches')">
                <div class="match-header">
                    <h3 style="margin: 0; color: var(--color-primary);">{{ league.name }}</h3>
                    <span class="league-status" [class]="'status-' + league.status">{{ league.status }}</span>
                </div>
                <div style="margin-top: var(--space-md); color: var(--color-text-muted);">
                    <p>Starts: {{ league.startDate | date }}</p>
                    <p>Ends: {{ league.endDate | date }}</p>
                </div>
                <div class="match-footer" style="margin-top: var(--space-md);">
                    <span class="view-details">View Matches →</span>
                </div>
            </div>
            }
        </div>
        }

        @if (activeSection() === 'stats') {
        <header class="dashboard-header">
            <div>
                <h1 class="text-gradient">Standings & Stats</h1>
                @if (selectedLeague()) {
                <p class="league-subtitle">{{ selectedLeague()?.name }} - Group Standings</p>
                }
            </div>
        </header>

        @if (selectedLeague()) {
        <div class="standings-container card">
            @if (standings().length === 0) {
            <div class="empty-state">
                <p>No matches completed yet. Standings will appear after the first score is recorded.</p>
            </div>
            } @else {
            <table class="standings-table">
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Player</th>
                        <th class="text-center">Matches</th>
                        <th class="text-right">Total Points</th>
                    </tr>
                </thead>
                <tbody>
                    @for (entry of standings(); track entry.email; let i = $index) {
                    <tr [class.currentUser]="entry.email === playerService.getCurrentPlayerId().toLowerCase()">
                        <td class="pos-cell">{{ i + 1 }}</td>
                        <td class="player-cell">
                            <span class="player-name">{{ entry.name }}</span>
                            @if (entry.email === playerService.getCurrentPlayerId().toLowerCase()) {
                            <span class="me-badge">YOU</span>
                            }
                        </td>
                        <td class="text-center">{{ entry.matchesPlayed }}</td>
                        <td class="score-cell text-right">{{ entry.totalScore }}</td>
                    </tr>
                    }
                </tbody>
            </table>
            }
        </div>
        } @else {
        <div class="empty-state card">
            <h3>No league selected</h3>
            <p>Select a league from the menu to see standings.</p>
        </div>
        }
        }
    </main>
</div>