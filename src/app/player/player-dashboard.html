<div class="dashboard-container">
    <!-- Sidebar with League Selection -->
    <aside class="sidebar">
        <h2 class="sidebar-title">My Leagues</h2>
        <div class="league-list">
            @for (league of leagues(); track league.id) {
            <button class="league-item" [class.selected]="selectedLeague()?.id === league.id"
                (click)="selectLeague(league.id)">
                <div class="league-info">
                    <span class="league-name">{{ league.name }}</span>
                    <span class="league-status" [class]="'status-' + league.status">
                        {{ league.status }}
                    </span>
                </div>
            </button>
            }
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="dashboard-header">
            <div>
                <h1 class="text-gradient">Upcoming Matches</h1>
                @if (selectedLeague()) {
                <p class="league-subtitle">{{ selectedLeague()?.name }}</p>
                }
            </div>
            <div class="header-actions">
                <a routerLink="/league" class="btn btn-secondary">Dashboard</a>
                <a routerLink="/player/leagues" class="btn btn-primary">Leagues</a>
            </div>
        </header>

        <!-- Matches Grid -->
        <div class="matches-grid">
            @if (upcomingMatches().length === 0) {
            <div class="empty-state card">
                <h3>No upcoming matches</h3>
                <p style="color: var(--color-text-muted);">
                    Check back later or select a different league.
                </p>
            </div>
            }
            @for (match of upcomingMatches(); track match.id) {
            <div class="match-card card" (click)="viewMatchDetail(match.id)">
                <div class="match-header">
                    <div class="match-date">
                        <span class="date-text">{{ formatDate(match.date) }}</span>
                        <span class="time-text">{{ match.time }}</span>
                    </div>
                    <div class="match-meta">
                        @if (match.groupId) {
                        <span class="group-badge">Group {{ match.groupId.replace('G', '') || '?' }}</span>
                        }
                        <span class="court-badge">{{ match.court || 'Court TBD' }}</span>
                    </div>
                </div>

                <div class="match-teams">
                    <div class="team my-team">
                        <span class="team-label">My Team</span>
                        <span class="team-players">{{ getTeammates(match) || 'Partner TBD' }}</span>
                    </div>

                    <div class="vs-divider">VS</div>

                    <div class="team opponent-team">
                        <span class="team-label">Opponents</span>
                        <span class="team-players">{{ getOpponents(match) }}</span>
                    </div>
                </div>

                <div class="match-footer">
                    <span class="league-tag">{{ match.leagueName }}</span>
                    <span class="view-details">View Details →</span>
                </div>
            </div>
            }
        </div>

        <!-- Completed Matches Grid -->
        <header class="dashboard-header" style="margin-top: var(--space-xl); margin-bottom: var(--space-lg);">
            <div>
                <h1 class="text-gradient">Completed Matches</h1>
            </div>
        </header>

        <div class="matches-grid">
            @if (completedMatches().length === 0) {
            <div class="empty-state card">
                <h3>No completed matches</h3>
                <p style="color: var(--color-text-muted);">
                    As you finish matches, they will appear here.
                </p>
            </div>
            }
            @for (match of completedMatches(); track match.id) {
            <div class="match-card card completed-card" (click)="viewMatchDetail(match.id)">
                <div class="match-header">
                    <div class="match-date">
                        <span class="date-text">{{ formatDate(match.date) }}</span>
                        <span class="time-text">{{ match.time }}</span>
                    </div>
                    <div class="match-meta">
                        @if (match.groupId) {
                        <span class="group-badge">Group {{ match.groupId.replace('G', '') || '?' }}</span>
                        }
                        <span class="court-badge">{{ match.court || 'Court TBD' }}</span>
                    </div>
                </div>

                <div class="match-teams">
                    <div class="team my-team" [class.winner]="(match.team1Score || 0) > (match.team2Score || 0)">
                        <div class="team-info-row">
                            <span class="team-label">My Team</span>
                            <span class="final-score">{{ match.team1Score }}</span>
                        </div>
                        <span class="team-players">{{ getTeammates(match) || 'Partner TBD' }}</span>
                    </div>

                    <div class="vs-divider">VS</div>

                    <div class="team opponent-team" [class.winner]="(match.team2Score || 0) > (match.team1Score || 0)">
                        <div class="team-info-row">
                            <span class="team-label">Opponents</span>
                            <span class="final-score">{{ match.team2Score }}</span>
                        </div>
                        <span class="team-players">{{ getOpponents(match) }}</span>
                    </div>
                </div>

                <div class="match-footer">
                    <span class="league-tag">{{ match.leagueName }}</span>
                    <span class="view-details">Match Results →</span>
                </div>
            </div>
            }
        </div>

        <!-- League Standings Section -->
        @if (selectedLeague()) {
        <header class="dashboard-header" style="margin-top: var(--space-xl); margin-bottom: var(--space-lg);">
            <div>
                <h1 class="text-gradient">Group Standings</h1>
                <p class="league-subtitle">Total points accumulated across all sessions</p>
            </div>
        </header>

        <div class="standings-container card">
            @if (standings().length === 0) {
            <div class="empty-state">
                <p>No matches completed yet. Standings will appear after the first score is recorded.</p>
            </div>
            } @else {
            <table class="standings-table">
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Player</th>
                        <th class="text-center">Matches</th>
                        <th class="text-right">Total Points</th>
                    </tr>
                </thead>
                <tbody>
                    @for (entry of standings(); track entry.email; let i = $index) {
                    <tr [class.currentUser]="entry.email === playerService.getCurrentPlayerId().toLowerCase()">
                        <td class="pos-cell">{{ i + 1 }}</td>
                        <td class="player-cell">
                            <span class="player-name">{{ entry.name }}</span>
                            @if (entry.email === playerService.getCurrentPlayerId().toLowerCase()) {
                            <span class="me-badge">YOU</span>
                            }
                        </td>
                        <td class="text-center">{{ entry.matchesPlayed }}</td>
                        <td class="score-cell text-right">{{ entry.totalScore }}</td>
                    </tr>
                    }
                </tbody>
            </table>
            }
        </div>
        }
    </main>
</div>